echo "ğŸ” Running pre-commit checks..."
echo ""

# Ensure Foundry is in PATH (for systems like Fork that don't source shell configs)
export PATH="$HOME/.foundry/bin:$PATH"

# Run lint-staged for linting and formatting
echo "ğŸ“ Linting and formatting..."
npx lint-staged || {
  echo "âŒ Linting failed! Fix errors before committing."
  exit 1
}

# Check if contracts or tests were changed
echo ""
CONTRACTS_CHANGED=$(git diff --cached --name-only | grep -E "^(contracts|test)/" || true)

if [ -z "$CONTRACTS_CHANGED" ]; then
  echo "â„¹ï¸  No contract or test changes detected"
  echo "âœ… Pre-commit checks passed! (tests skipped)"
  exit 0
fi

# Run Hardhat tests
echo ""
echo "ğŸ§ª Running Hardhat tests..."
npm test || {
  echo "âŒ Hardhat tests failed! Fix tests before committing."
  exit 1
}

# Run Foundry tests
echo ""
echo "âš¡ Running Foundry tests..."
npm run test:foundry || {
  echo "âŒ Foundry tests failed! Fix tests before committing."
  exit 1
}

echo ""
echo "âœ… All pre-commit checks passed!"
